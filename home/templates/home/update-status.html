{% extends "base.html" %}

{% load wagtailcore_tags template_tags static %}

{% block body_class %}Updates Status{% endblock %}

{% block title %}
    {% if page.seo_title %}
        {{ page.seo_title }}
    {% else %}
        {{ page.title }}
    {% endif %}
{% endblock %}

{% block meta_title %}
    {% if page.seo_title %}
        {{ page.seo_title }}
    {% else %}
        {{ page.title }}
    {% endif %}
{% endblock %}

{% block meta_description %}
    {% if page.search_description %}
        {{ page.search_description }}
    {% endif %}
{% endblock %}

{% block head %}
    <link rel="stylesheet" href="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">
    <script src="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>
    <style>
        .ct-series-a .ct-area, .ct-series-a .ct-slice-donut-solid, .ct-series-a .ct-slice-pie  {
            fill: rgba(67,160,71,var(--tw-bg-opacity));
        }
        .ct-label {
            fill: white;
            font-weight: bold;
        }
    </style>
{% endblock %}

{% block content %}
<div class="px-4 pb-16 mx-auto sm:max-w-xl md:max-w-full lg:max-w-screen-xl md:px-24 lg:px-8 lg:pb-20">
    <div class="nice-padding">
        <div class="flex justify-center">
            <form method="get" class="grid grid-cols-3 mb-10">
              <div class="form-check">
                <input name="branch" class="form-check-input appearance-none h-4 w-4 border border-gray-300 rounded-sm bg-white checked:bg-blue-600 checked:border-blue-600 focus:outline-none transition duration-200 mt-1 align-top bg-no-repeat bg-center bg-contain float-left mr-2 cursor-pointer" type="checkbox" value="stable" id="stable" {% if branch == 'stable' %}checked{% endif %}>
                <label class="form-check-label inline-block text-gray-800" for="stable">
                  Stable
                </label>
              </div>
              <div class="form-check">
                <input name="branch" class="form-check-input appearance-none h-4 w-4 border border-gray-300 rounded-sm bg-white checked:bg-blue-600 checked:border-blue-600 focus:outline-none transition duration-200 mt-1 align-top bg-no-repeat bg-center bg-contain float-left mr-2 cursor-pointer" type="checkbox" value="testing" id="testing" {% if branch == 'testing' %}checked{% endif %}>
                <label class="form-check-label inline-block text-gray-800" for="testing">
                  Testing
                </label>
              </div>
              <div class="form-check">
                <input name="branch" class="form-check-input appearance-none h-4 w-4 border border-gray-300 rounded-sm bg-white checked:bg-blue-600 checked:border-blue-600 focus:outline-none transition duration-200 mt-1 align-top bg-no-repeat bg-center bg-contain float-left mr-2 cursor-pointer" type="checkbox" value="unstable" id="unstable" {% if branch == 'unstable' %}checked{% endif %}>
                <label class="form-check-label inline-block text-gray-800" for="unstable">
                  Unstable
                </label>
              </div>
            </form>
        </div>
        <div class="w-full grid grid-cols-1 gap-8 place-items-center text-left text-sm ">
                {% for topic in topics|slice:":5" %}               
                    <div class="bg-no-repeat bg-cover h-96 w-full flex items-end relative" style="background-image: url({{ topic.image_url }})" >
                        <div id="ct-chart{{ topic.id }}" class="ct-chart w-60 h-60 absolute top-1 left-1">
                            <div class="text-gray-200 absolute top-20 left-36 pl-1 font-semibold">{{ topic.posts_count }} Posts</div>
                            <div class="text-gray-200 absolute top-24 left-36 pt-1 pl-1 font-semibold">{{ topic.voters }} Votes</div>
                           </div>
                        <div class="h-18 p-4 bg-gray-900/75 w-full">
                            <a class="transition-colors duration-200 text-gray-400 hover:text-white font-semibold" href="https://forum.manjaro.org/t/{{ topic.id }}" target="_blank">
                                {{ topic.title }}
                            </a>
                        </div>
                    </div>
                <script>
                    var red = parseInt('{{ topic.poll_pourcent }}')
                    var green = 100 - red
                    console.log('{{ topic.poll_pourcent }}%')
                    var data = {
                    series: [green, red]
                    };

                    var sum = function(a, b) { return a + b };

                    new Chartist.Pie('#ct-chart{{ topic.id }}', data, {
                    labelInterpolationFnc: function(value) {
                        return Math.round(value / data.series.reduce(sum) * 100) + '%';
                    }
                    });
                </script>
                {% endfor %}
            </div>
    </div>
</div>
<script>
    const input = document.querySelectorAll('input');

    [].forEach.call(input, function(el) {
    el.addEventListener("change", function (el) {
        [].forEach.call(input, function(elem) {
            if (elem.id == el.target.id) {
                elem.checked = true
            } else {
                elem.checked = false
            }
        })
        let url = window.location.origin + window.location.pathname + "?branch=" + el.target.id
        window.location.replace(url)
    })
    });
</script>
{% endblock %}